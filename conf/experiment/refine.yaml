# @package _global_

# HPO settings for Phase 5b: Refinement
# Objective: Deep search within the "Region of Interest" found in Phase 5a.

experiment:
  name: Phase5b_Refine

optimization:
  n_trials: 30 # As requested
  timeout_seconds: null 
  metric: 'sharpe' 
  max_eval_steps: 2000
  direction: 'maximize' 

  # <<< STRATEGIC IMPROVEMENT APPLIED >>>
  # The pruner has been made slightly less aggressive to reduce the risk of
  # prematurely eliminating a "late-blooming" agent that may show superior
  # performance later in training. This provides a better balance between
  # computational efficiency and finding the true optimal agent.
  pruning: 
    enabled: true 
    pruner_type: MedianPruner
    n_startup_trials: 5
    n_warmup_steps: 10 # <-- Increased from 4. Gives agents more time to mature.
    interval_steps: 2 
  
  n_jobs: 1 
  
  trial_timesteps: 90000 
  
  # --- REFINED Search Space based on Phase 5a Analysis ---
  lr_min: 1e-6
  lr_max: 3e-6
  
  ppo_n_steps_choices_hpo: [512] # Focus on the best value
  batch_size_choices: [32, 64, 128]
  
  gamma_min: 0.98
  gamma_max: 0.999
  
  gae_lambda_min: 0.81
  gae_lambda_max: 0.98
  
  ent_coef_min: 0.005
  ent_coef_max: 0.01
  
  vf_coef_min: 0.26
  vf_coef_max: 0.56
  
  max_grad_norm_min: 2.1
  max_grad_norm_max: 4.9
  
  clip_range_min: 0.30
  clip_range_max: 0.38
  
  weight_decay_min: 1e-4
  weight_decay_max: 1e-3

  activity_reward_scale_min: 0.03
  activity_reward_scale_max: 0.1
  
  # --- Model Architecture: Focused Search ---
  mamba_layers_min: 2 
  mamba_layers_max: 3 # Focus on shallow models (2-3 layers)
  mamba_d_model_choices: [64, 128] # Focus on the two best options
  mamba_d_state_choices: [8, 16, 32]
  features_dim_choices: [128] # Focus on the best value
  dropout_min: 0.15
  dropout_max: 0.2
  
  # --- Feature Parameters: Focused Search ---
  hurst_window_choices: [50] # Focus on the best value
  momentum_window_choices: [10, 21, 42]
  volatility_window_choices: [10, 21, 42]